<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Instrumentmuutuja – Põhjuslike seoste hindamine majanduses</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-synthcontr.html" rel="next">
<link href="./06-sobitamine.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70a47bd5681a7291082a5b9f83d58762.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Tulemusi pole",
    "search-matching-documents-text": "sobivat dokumenti",
    "search-copy-link-title": "Kopeeri link otsingule",
    "search-hide-matches-text": "Peida lisavastavused",
    "search-more-match-text": "veel üks vastavus selles dokumendis",
    "search-more-matches-text": "rohkem vastavusi selles dokumendis",
    "search-clear-button-title": "Puhasta",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Tühista",
    "search-submit-button-title": "Esita",
    "search-label": "Otsi"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Lülita külgriba navigeerimist" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-ivmeetod.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Instrumentmuutuja</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Lülita külgriba navigeerimist" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Otsi" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Põhjuslike seoste hindamine majanduses</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Otsi"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Eessõna</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-sissejuhatus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Sissejuhatus</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pohimoistedkordamiseks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Põhimõisted eksamiks kordamiseks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-pohimoisted.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Põhimõisted</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-regressioon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regressioonimudeli kasutamine</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-difdif.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Juurdekasvude erinevus (Dif-Dif)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-rdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regressiooni katkemise meetod</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-sobitamine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Sobitamine</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-ivmeetod.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Instrumentmuutuja</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-synthcontr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Sünteetilise võrdlusobjekti meetod</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-mlpuumets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Masinõppemudelid</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-mllasso.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">LASSO mõju hindamisel</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-tehajaideed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Teha</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sisukord</h2>
   
  <ul>
  <li><a href="#seade" id="toc-seade" class="nav-link active" data-scroll-target="#seade"><span class="header-section-number">8.1</span> Seade</a>
  <ul class="collapse">
  <li><a href="#motivatsioon-endogeensus-ja-väljajäetud-muutuja-nihe" id="toc-motivatsioon-endogeensus-ja-väljajäetud-muutuja-nihe" class="nav-link" data-scroll-target="#motivatsioon-endogeensus-ja-väljajäetud-muutuja-nihe">Motivatsioon: endogeensus ja väljajäetud muutuja nihe</a></li>
  </ul></li>
  <li><a href="#mis-on-instrumentmuutuja" id="toc-mis-on-instrumentmuutuja" class="nav-link" data-scroll-target="#mis-on-instrumentmuutuja"><span class="header-section-number">8.2</span> Mis on instrumentmuutuja?</a></li>
  <li><a href="#lihtne-näide-ja-waldi-valem" id="toc-lihtne-näide-ja-waldi-valem" class="nav-link" data-scroll-target="#lihtne-näide-ja-waldi-valem"><span class="header-section-number">8.3</span> Lihtne näide ja Waldi valem</a></li>
  <li><a href="#kahesammuline-vähimruutude-meetod-2sls" id="toc-kahesammuline-vähimruutude-meetod-2sls" class="nav-link" data-scroll-target="#kahesammuline-vähimruutude-meetod-2sls"><span class="header-section-number">8.4</span> Kahesammuline vähimruutude meetod (2SLS)</a></li>
  <li><a href="#sobivate-instrumentide-kriteeriumid" id="toc-sobivate-instrumentide-kriteeriumid" class="nav-link" data-scroll-target="#sobivate-instrumentide-kriteeriumid"><span class="header-section-number">8.5</span> Sobivate instrumentide kriteeriumid</a>
  <ul class="collapse">
  <li><a href="#relevantsus" id="toc-relevantsus" class="nav-link" data-scroll-target="#relevantsus">Relevantsus</a></li>
  <li><a href="#eksogeensus-ja-väljajätmise-eeldus-exclusion-restriction" id="toc-eksogeensus-ja-väljajätmise-eeldus-exclusion-restriction" class="nav-link" data-scroll-target="#eksogeensus-ja-väljajätmise-eeldus-exclusion-restriction">Eksogeensus ja väljajätmise eeldus (exclusion restriction)</a></li>
  </ul></li>
  <li><a href="#nõrgad-ja-valed-instrumendid" id="toc-nõrgad-ja-valed-instrumendid" class="nav-link" data-scroll-target="#nõrgad-ja-valed-instrumendid"><span class="header-section-number">8.6</span> Nõrgad ja valed instrumendid</a></li>
  <li><a href="#heterogeensed-mõjud-ja-late" id="toc-heterogeensed-mõjud-ja-late" class="nav-link" data-scroll-target="#heterogeensed-mõjud-ja-late"><span class="header-section-number">8.7</span> Heterogeensed mõjud ja LATE</a>
  <ul class="collapse">
  <li><a href="#seos-regressiooni-katkemise-disainiga-rdd" id="toc-seos-regressiooni-katkemise-disainiga-rdd" class="nav-link" data-scroll-target="#seos-regressiooni-katkemise-disainiga-rdd">Seos regressiooni katkemise disainiga (RDD)</a></li>
  </ul></li>
  <li><a href="#kas-iv-meetodit-üldse-vaja-on-hausmani-test" id="toc-kas-iv-meetodit-üldse-vaja-on-hausmani-test" class="nav-link" data-scroll-target="#kas-iv-meetodit-üldse-vaja-on-hausmani-test"><span class="header-section-number">8.8</span> Kas IV-meetodit üldse vaja on? Hausmani test</a></li>
  <li><a href="#instrumentide-leidmine" id="toc-instrumentide-leidmine" class="nav-link" data-scroll-target="#instrumentide-leidmine"><span class="header-section-number">8.9</span> Instrumentide leidmine</a></li>
  <li><a href="#kokkuvõte" id="toc-kokkuvõte" class="nav-link" data-scroll-target="#kokkuvõte"><span class="header-section-number">8.10</span> Kokkuvõte</a></li>
  <li><a href="#näide" id="toc-näide" class="nav-link" data-scroll-target="#näide"><span class="header-section-number">8.11</span> Näide</a>
  <ul class="collapse">
  <li><a href="#andmed" id="toc-andmed" class="nav-link" data-scroll-target="#andmed">Andmed</a></li>
  </ul></li>
  <li><a href="#avame-andmed" id="toc-avame-andmed" class="nav-link" data-scroll-target="#avame-andmed"><span class="header-section-number">8.12</span> Avame andmed</a>
  <ul class="collapse">
  <li><a href="#ols" id="toc-ols" class="nav-link" data-scroll-target="#ols">OLS</a></li>
  </ul></li>
  <li><a href="#kahesammulise-vähimruutude-meetodi-2sls-hinnang" id="toc-kahesammulise-vähimruutude-meetodi-2sls-hinnang" class="nav-link" data-scroll-target="#kahesammulise-vähimruutude-meetodi-2sls-hinnang"><span class="header-section-number">8.13</span> Kahesammulise vähimruutude meetodi (2SLS) hinnang</a>
  <ul class="collapse">
  <li><a href="#esimene-samm-lojaalsusprogrammi-liikmesuse-prognoosimine" id="toc-esimene-samm-lojaalsusprogrammi-liikmesuse-prognoosimine" class="nav-link" data-scroll-target="#esimene-samm-lojaalsusprogrammi-liikmesuse-prognoosimine">Esimene samm: Lojaalsusprogrammi liikmesuse prognoosimine</a></li>
  </ul></li>
  <li><a href="#teise-etapi-kokkuvõte" id="toc-teise-etapi-kokkuvõte" class="nav-link" data-scroll-target="#teise-etapi-kokkuvõte"><span class="header-section-number">9</span> Teise etapi kokkuvõte</a>
  <ul class="collapse">
  <li><a href="#testid" id="toc-testid" class="nav-link" data-scroll-target="#testid"><span class="header-section-number">9.1</span> Testid</a></li>
  <li><a href="#kas-instrumendid-on-tugevad" id="toc-kas-instrumendid-on-tugevad" class="nav-link" data-scroll-target="#kas-instrumendid-on-tugevad"><span class="header-section-number">9.2</span> Kas instrumendid on tugevad?</a></li>
  <li><a href="#kas-instrumendid-on-sobivad" id="toc-kas-instrumendid-on-sobivad" class="nav-link" data-scroll-target="#kas-instrumendid-on-sobivad"><span class="header-section-number">9.3</span> Kas instrumendid on sobivad?</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Instrumentmuutuja</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="seade" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="seade"><span class="header-section-number">8.1</span> Seade</h2>
<p>Instrumentmuutuja meetod (instrumental variable method, IV) on üks olulisemaid tööriistu olukordades, kus regressioonimudeli selgitav tunnus on endogeenne – st korreleerub vealiikmega. Sellisel juhul on tavalise OLS-regressiooni hinnangud nihkega ja ei ole mõjusad isegi väga suurtes valimites. IV-meetod püüab eraldada selle osa varieeruvusest, mis on “puhas” ja ei ole saastunud jälgimata teguritest.:contentReference<span data-index="0">oaicite:0</span></p>
<section id="motivatsioon-endogeensus-ja-väljajäetud-muutuja-nihe" class="level3">
<h3 class="anchored" data-anchor-id="motivatsioon-endogeensus-ja-väljajäetud-muutuja-nihe">Motivatsioon: endogeensus ja väljajäetud muutuja nihe</h3>
<p>Olgu lihtne lineaarne mudel</p>
<p><span class="math display">\[
Y_i = \alpha + \beta D_i + \gamma^\top X_i + u_i,
\]</span></p>
<p>kus</p>
<ul>
<li><span class="math inline">\(Y_i\)</span> – tulemus (nt palk),</li>
<li><span class="math inline">\(D_i\)</span> – meede või huvipakkuv selgitaja (nt haridus, tööturukoolitus),</li>
<li><span class="math inline">\(X_i\)</span> – kontrollmuutujad (nt vanus, sugu, haridus jne),</li>
<li><span class="math inline">\(u_i\)</span> – vealiige, mis sisaldab kõiki muid, mudelisse mitte kaasatud tegureid.</li>
</ul>
<p>OLS-meetodi põhieelduseks on, et selgitavad tunnused on eksogeensed:</p>
<p><span class="math display">\[
\mathbb{E}[u_i \mid D_i, X_i] = 0
\quad\Longleftrightarrow\quad
\operatorname{Cov}(D_i, u_i) = 0.
\]</span></p>
<p>Paljudes rakendustes see ei kehti:</p>
<ul>
<li>hariduse ja palga puhul on <span class="math inline">\(D_i\)</span> (haridus) sageli korreleeritud võimekuse, motivatsiooni, perekondliku tausta jms-ga, mis on vealiikmes <span class="math inline">\(u_i\)</span>;</li>
<li>tööturukoolituse ja palga puhul osalevad koolitusel suurema tõenäosusega need, kes on motiveeritumad või kellel on paremad kontaktid;</li>
<li>lojaalsusprogrammi mõju ostusummale: programmiga liituvad pigem need kliendid, kes nagunii poes käivad.</li>
</ul>
<p>Kui <span class="math inline">\(\operatorname{Cov}(D_i, u_i) \neq 0\)</span>, tekib väljajäetud muutuja nihe (omitted variable bias) ning OLS-i hinnang <span class="math inline">\(\hat\beta^{OLS}\)</span> ei ole põhjuslik mõju.</p>
</section>
</section>
<section id="mis-on-instrumentmuutuja" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="mis-on-instrumentmuutuja"><span class="header-section-number">8.2</span> Mis on instrumentmuutuja?</h2>
<p>IV-meetodi idee on kasutada lisaks instrumenti <span class="math inline">\(Z_i\)</span>, mis mõjutab probleemset selgitajat <span class="math inline">\(D_i\)</span>, kuid ei mõjuta tulemust <span class="math inline">\(Y_i\)</span> muul viisil kui <span class="math inline">\(D_i\)</span> kaudu.</p>
<p>Informaalne graafik:</p>
<ul>
<li><span class="math inline">\(Z_i\)</span> → mõjutab <span class="math inline">\(D_i\)</span>,</li>
<li><span class="math inline">\(D_i\)</span> → mõjutab <span class="math inline">\(Y_i\)</span>,</li>
<li>taustamuutuja <span class="math inline">\(A_i\)</span> (nt võimekus) mõjutab nii <span class="math inline">\(D_i\)</span> kui <span class="math inline">\(Y_i\)</span>,</li>
<li>tahame sulgeda “tagaukse” <span class="math inline">\(D_i \leftarrow A_i \rightarrow Y_i\)</span>.</li>
</ul>
<p>Instrumentmuutuja <span class="math inline">\(Z_i\)</span> on sobiv, kui ta täidab kolme põhi-eeldust:</p>
<ol type="1">
<li><p>Relevantsus: <span class="math inline">\(Z_i\)</span> on piisavalt tugevasti seotud <span class="math inline">\(D_i\)</span>-ga<br>
<span class="math display">\[
\operatorname{Cov}(Z_i, D_i) \neq 0.
\]</span></p></li>
<li><p>Eksogeensus: <span class="math inline">\(Z_i\)</span> ei korreleeru vealiikmega<br>
<span class="math display">\[
\operatorname{Cov}(Z_i, u_i) = 0.
\]</span></p></li>
<li><p>Väljajätmise eeldus (exclusion restriction): <span class="math inline">\(Z_i\)</span> ei mõjuta <span class="math inline">\(Y_i\)</span> otseselt, vaid ainult läbi <span class="math inline">\(D_i\)</span>; st puudub otsene tee <span class="math inline">\(Z_i \to Y_i\)</span>.</p></li>
</ol>
<p>Relevantsust saab andmetest testida (nõrgad instrumendid), eksogeensust ja väljajätmise eeldust tuleb enamasti põhjendada teoreetiliselt ja institutsionaalse konteksti abil.</p>
</section>
<section id="lihtne-näide-ja-waldi-valem" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="lihtne-näide-ja-waldi-valem"><span class="header-section-number">8.3</span> Lihtne näide ja Waldi valem</h2>
<p>Vaatame kõige lihtsamat juhtu, kus:</p>
<ul>
<li><span class="math inline">\(D_i\)</span> on binaarne (osales/ei osalenud),</li>
<li><span class="math inline">\(Z_i\)</span> on binaarne instrument (nt poliitikamuutus, juhuslik loosimine),</li>
<li>kontrollmuutujaid ei ole.</li>
</ul>
<p>Mudel:</p>
<p><span class="math display">\[
Y_i = \alpha + \beta D_i + u_i.
\]</span></p>
<p>IV loogika:</p>
<ul>
<li>võrdleme keskmist tulemust nende vahel, kellel <span class="math inline">\(Z_i=1\)</span> ja <span class="math inline">\(Z_i=0\)</span>;</li>
<li>võrdleme, kui palju erineb keskmine osalemine <span class="math inline">\(D_i\)</span> nende kahe grupi vahel.</li>
</ul>
<p>Wald-hinnang on:</p>
<p><span class="math display">\[
\hat\beta^{IV} =
\frac{\mathbb{E}[Y_i \mid Z_i = 1] - \mathbb{E}[Y_i \mid Z_i = 0]}
     {\mathbb{E}[D_i \mid Z_i = 1] - \mathbb{E}[D_i \mid Z_i = 0]}.
\]</span></p>
<p>Tähendused:</p>
<ul>
<li>nimetaja kirjeldab instrumendi mõju osalus-tõenäosusele;</li>
<li>lugeja kirjeldab instrumendi mõju tulemusele;</li>
<li>suhe ütleb, kui palju <span class="math inline">\(Y_i\)</span> muutub instrumendi poolt esile kutsutud ühikulise muutuse kohta <span class="math inline">\(D_i\)</span>-s.</li>
</ul>
<p>Kui instrument on binaarne ja kontrollmuutujaid ei ole, langeb see kokku klassikalise Waldi hinnanguga.</p>
</section>
<section id="kahesammuline-vähimruutude-meetod-2sls" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="kahesammuline-vähimruutude-meetod-2sls"><span class="header-section-number">8.4</span> Kahesammuline vähimruutude meetod (2SLS)</h2>
<p>Üldisemal juhul on:</p>
<p><span class="math display">\[
Y_i = \alpha + \beta D_i + \gamma^\top X_i + u_i,
\]</span> <span class="math display">\[
D_i = \pi_0 + \pi_1 Z_i + \pi_2^\top X_i + v_i,
\]</span></p>
<p>kus <span class="math inline">\(Z_i\)</span> võib olla skalaarkomponent või vektor (mitu instrumenti).</p>
<p>Kahesammuline vähimruutude meetod (Two-Stage Least Squares, 2SLS) toimib järgmiselt.</p>
<p>Esimene samm (esimene etapp):</p>
<p><span class="math display">\[
D_i = \hat\pi_0 + \hat\pi_1 Z_i + \hat\pi_2^\top X_i + \hat v_i.
\]</span></p>
<ul>
<li>Hinnatakse regressioon <span class="math inline">\(D_i\)</span>-le instrumendi ja kontrollmuutujate peale.</li>
<li>Saadakse prognoosid <span class="math inline">\(\hat D_i = \hat\pi_0 + \hat\pi_1 Z_i + \hat\pi_2^\top X_i\)</span>.</li>
<li>Sisuliselt eraldame <span class="math inline">\(D_i\)</span> selles osas, mida selgitavad <span class="math inline">\(Z_i\)</span> ja <span class="math inline">\(X_i\)</span>, ning eemaldame osa, mis on korreleeritud vealiikmega.</li>
</ul>
<p>Teine samm (teine etapp):</p>
<p><span class="math display">\[
Y_i = \alpha + \beta \hat D_i + \gamma^\top X_i + \varepsilon_i.
\]</span></p>
<ul>
<li>Asendame algses mudelis <span class="math inline">\(D_i\)</span> tema prognoosiga <span class="math inline">\(\hat D_i\)</span> ning kasutame OLS-i.</li>
<li>Saadud <span class="math inline">\(\hat\beta^{2SLS}\)</span> on IV-hinnang, mis kasutab ainult seda osa $D_i&nbsp;varieeruvusest, mida instrument <span class="math inline">\(Z_i\)</span> ja <span class="math inline">\(X_i\)</span> suudavad selgitada.</li>
</ul>
<p>R-is saab seda mugavalt teha näiteks paketiga AER:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Näide: palk sõltub haridusest, kus haridus on endogeenne,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># instrumentideks näiteks regionaalsed või perekondlikud tunnused</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>iv_mod <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                      motheduc <span class="sc">+</span> fatheduc <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> mydata)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iv_mod)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Parempoolsel poolel: vasak pool enne <code>|</code> on struktuurne mudel (<code>Y ~</code> endogeensed + eksogeensed tunnused), parem pool pärast <code>|</code> on instrumendid ja eksogeensed tunnused.</p>
</section>
<section id="sobivate-instrumentide-kriteeriumid" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="sobivate-instrumentide-kriteeriumid"><span class="header-section-number">8.5</span> Sobivate instrumentide kriteeriumid</h2>
<p>Instrumentide jaoks kehtivad järgmised põhinõuded.</p>
<section id="relevantsus" class="level3">
<h3 class="anchored" data-anchor-id="relevantsus">Relevantsus</h3>
<p>Instrument peab olema piisavalt tugevalt seotud selgitava tunnusega <span class="math inline">\(D_i\)</span>:</p>
<ul>
<li><span class="math inline">\(\operatorname{Cov}(Z_i, D_i) \neq 0\)</span><br>
</li>
<li>Esimeses etapis saab seda hinnata F-statistikuga. Lihtne rusikareegel:
<ul>
<li>kui <span class="math inline">\(F &lt; 10\)</span>, võib instrument olla <strong>nõrk</strong>;</li>
<li>nõrkade instrumentide korral on IV-hinnangud väga ebatäpsed (suured standardvead) ja võivad olla tugevalt nihkega.</li>
</ul></li>
</ul>
</section>
<section id="eksogeensus-ja-väljajätmise-eeldus-exclusion-restriction" class="level3">
<h3 class="anchored" data-anchor-id="eksogeensus-ja-väljajätmise-eeldus-exclusion-restriction">Eksogeensus ja väljajätmise eeldus (exclusion restriction)</h3>
<ul>
<li>Instrument ei tohi korreleeruda vealiikmega <span class="math inline">\(u_i\)</span>:
<ul>
<li><span class="math inline">\(\operatorname{Cov}(Z_i, u_i) = 0\)</span>.</li>
</ul></li>
<li>Instrument ei tohi mõjutada <span class="math inline">\(Y_i\)</span> otse, vaid üksnes läbi <span class="math inline">\(D_i\)</span>:
<ul>
<li>puudub otsene tee <span class="math inline">\(Z_i \to Y_i\)</span>; mõju peab käima ainult <span class="math inline">\(Z_i \to D_i \to Y_i\)</span> kaudu.</li>
</ul></li>
</ul>
<p>Kui instrumente on rohkem kui endogeenseid muutujaid (üleidentifitseeritud mudel), saab eksogeensust osaliselt testida <strong>üleidentifitseerimiskatsetega</strong> (Sargani või Hansen–J test), kontrollides, kas kõik instrumendid korraga sobituvad mudelisse ilma oluliste vastuoludeta.</p>
</section>
</section>
<section id="nõrgad-ja-valed-instrumendid" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="nõrgad-ja-valed-instrumendid"><span class="header-section-number">8.6</span> Nõrgad ja valed instrumendid</h2>
<ul>
<li>Kui <span class="math inline">\(Z_i\)</span> ei korreleeru <span class="math inline">\(D_i\)</span>-ga, on tegemist <strong>ebaoluliste instrumentidega</strong>; IV-meetod ei anna lisainfot ja hinnangud käituvad halvasti.</li>
<li>Kui seos on olemas, kuid väga nõrk, on tegemist <strong>nõrkade instrumentidega</strong>. Siis on IV-hinnangud asümptootiliselt küll mõjusad, kuid väikeses valimis väga ebatäpsed.</li>
<li>Kui instrument korreleerub vealiikmega (nt mõjutab tegelikult otseselt <span class="math inline">\(Y_i\)</span>) või on seotud jälgimata teguritega <span class="math inline">\(A_i\)</span>, siis on instrument <strong>vigane</strong>. Sellisel juhul annab IV-meetod valesuunalise hinnangu.</li>
</ul>
<p>Praktikas on tihti valik:</p>
<ul>
<li>kas kasutada nihkega, kuid väiksema variatsiooniga OLS-hinnangut;</li>
<li>või kasutada IV-meetodit, mis põhineb tugevatele eeldustele ja millel võivad olla suured standardvead.</li>
</ul>
</section>
<section id="heterogeensed-mõjud-ja-late" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="heterogeensed-mõjud-ja-late"><span class="header-section-number">8.7</span> Heterogeensed mõjud ja LATE</h2>
<p>Kui mõju <span class="math inline">\(\beta\)</span> ei ole kõigi jaoks sama (heterogeensed mõjud), ei pruugi IV-hinnang kirjeldada keskmist mõju kõigile. Binaarse instrumendi ja binaarse meetme korral, täiendavate eelduste (näiteks monotoolsuse) all, identifitseerib Waldi/IV-hinnang nn <strong>kohaliku keskmise mõju</strong> (Local Average Treatment Effect, LATE):</p>
<ul>
<li>LATE on keskmine mõju nende isikute seas, kelle meedme staatus muutub instrumendi väärtuse muutumise tõttu (<em>compliers</em> ehk “allujad”).</li>
</ul>
<p>Ülejäänud rühmad:</p>
<ul>
<li><em>never-takers</em> – ei osale kunagi;</li>
<li><em>always-takers</em> – alati osalevad;</li>
<li><em>defiers</em> – käituvad instrumendile vastupidiselt.</li>
</ul>
<p>Nende kohta IV otseselt infot ei anna.</p>
<section id="seos-regressiooni-katkemise-disainiga-rdd" class="level3">
<h3 class="anchored" data-anchor-id="seos-regressiooni-katkemise-disainiga-rdd">Seos regressiooni katkemise disainiga (RDD)</h3>
<ul>
<li>RDD-s on instrument <span class="math inline">\(Z_i\)</span> tavaliselt “olla üle lõikepunkti” (näiteks <span class="math inline">\(Z_i = 1\)</span>, kui <span class="math inline">\(X_i \ge c\)</span>).</li>
<li>RDD <strong>sharp design</strong> vastab olukorrale, kus instrument määrab <span class="math inline">\(D_i\)</span> deterministlikult (kõik üle lõikepunkti osalevad, kõik allpool mitte).</li>
<li>RDD <strong>fuzzy design</strong> vastab klassikalisele LATE-olukorrale, kus instrument mõjutab ainult osalemise tõenäosust, mitte ei määra seda täpselt.</li>
</ul>
</section>
</section>
<section id="kas-iv-meetodit-üldse-vaja-on-hausmani-test" class="level2" data-number="8.8">
<h2 data-number="8.8" class="anchored" data-anchor-id="kas-iv-meetodit-üldse-vaja-on-hausmani-test"><span class="header-section-number">8.8</span> Kas IV-meetodit üldse vaja on? Hausmani test</h2>
<p>Kui kahtleme, kas endogeensus on tõsine probleem, on mitmeid võimalusi seda hinnata.</p>
<p>Üks levinud lähenemine on <strong>Hausmani tüüpi spetsifikatsioonitest</strong>:</p>
<ul>
<li><span class="math inline">\(H_0\)</span>: mudelis ei ole endogeensust; OLS on mõjus ja efektiivne; OLS ja IV annavad sarnased hinnangud.</li>
<li><span class="math inline">\(H_1\)</span>: esineb endogeensus; OLS on nihkega; IV on mõjus, kui instrumendid on sobivad.</li>
</ul>
<p>Praktiline mõte:</p>
<ol type="1">
<li>hinnata OLS-mudel;</li>
<li>hinnata IV/2SLS-mudel;</li>
<li>võrrelda hinnanguid ja statistikat (nt spetsiaalsete testifunktsioonidega).</li>
</ol>
<p>Teine lähenemine on <strong>kontrollfunktsiooni meetod</strong>, kus:</p>
<ol type="1">
<li>Esimeses etapis hinnatakse <span class="math inline">\(D_i\)</span> sõltuvust instrumentidest ja eksogeensetest tunnustest ning saadakse jääk <span class="math inline">\(\hat v_i\)</span>.</li>
<li>Teises etapis lisatakse <span class="math inline">\(\hat v_i\)</span> struktuursesse mudelisse lisatunnusena.
<ul>
<li>Kui <span class="math inline">\(\hat v_i\)</span> kordaja on statistiliselt oluline, on endogeensus probleem.<br>
</li>
<li>Kui mitte, siis võib OLS olla piisav.</li>
</ul></li>
</ol>
</section>
<section id="instrumentide-leidmine" class="level2" data-number="8.9">
<h2 data-number="8.9" class="anchored" data-anchor-id="instrumentide-leidmine"><span class="header-section-number">8.9</span> Instrumentide leidmine</h2>
<p>Praktiliselt on suurim probleem leida <strong>hea instrument</strong>. Mõned tüüpilised allikad:</p>
<ul>
<li>regionaalne varieeruvus teenuste kättesaadavuses, mis ei sõltu individuaalsetest omadustest<br>
(näiteks kaugus ülikoolist, haiglast, koolitusasutusest);</li>
<li>poliitikamuutused ja institutsionaalsed reeglid<br>
(näiteks muutus toetuse tingimustes, mis sõltub ainult sünniaastast, piirkonnast või mõnest teisest välistunnusest);</li>
<li>ajaline varieeruvus: meetmed, mis rakenduvad erineval ajal erinevates piirkondades;</li>
<li>minevikuväärtused paneelandmetes (lagged variables), kui need on usutavalt eksogeensed;</li>
<li>randomiseeritud eksperimendid: ideaalne, “täiuslik” instrument.</li>
</ul>
<p>Iga kord tuleb läbi mõelda:</p>
<ul>
<li>kas instrument mõjutab selgitavat tunnust piisavalt tugevasti;</li>
<li>kas on usutav, et instrument ei mõjuta otseselt tulemust;</li>
<li>kas pole muid kanaleid (väljajätmise eeldus), mille kaudu instrument ja tulemus sõltuda võiksid.</li>
</ul>
</section>
<section id="kokkuvõte" class="level2" data-number="8.10">
<h2 data-number="8.10" class="anchored" data-anchor-id="kokkuvõte"><span class="header-section-number">8.10</span> Kokkuvõte</h2>
<p>Instrumentmuutuja meetod:</p>
<ul>
<li>on mõeldud olukordadeks, kus selgitav tunnus on endogeenne ja tavaline regressioon annab nihkega hinnanguid;</li>
<li>kasutab ainult seda osa varieeruvusest, mis on “tekitatud” instrumendi poolt ja on seetõttu vealiikmest sõltumatu;</li>
<li>tugineb tugevatele eeldustele instrumendi eksogeensuse ja väljajätmise kohta, mida alati ei saa otseselt testida;</li>
<li>annab heterogeensete mõjude korral lokaalse keskmise mõjuhinnangu (LATE) just nendele, keda instrument tegelikult “liigutab”.</li>
</ul>
<p>Analüütiku ülesanne on leida veenev instrument, põhjendada selle sobivust ning kontrollida esimeses etapis instrumentide tugevust ja teises etapis mudeli kooskõlalisust. Nõrk või vigane instrument on sageli hullem kui lihtne, ausalt nihkega OLS.</p>
</section>
<section id="näide" class="level2" data-number="8.11">
<h2 data-number="8.11" class="anchored" data-anchor-id="näide"><span class="header-section-number">8.11</span> Näide</h2>
<p>See näide püüab korrata lähenemist, mis kasutati Leenheer jt. artiklis.</p>
<p>Vt Jorna Leenheer, Harald J. van Heerde, Tammo H.A. Bijmolt, Ale Smidts, “Do loyalty programs really enhance behavioral loyalty? An empirical analysis accounting for self-selecting members, International Journal of Research in Marketing,”, Volume 24, Issue 1, 2007, Pages 31-47, ISSN 0167-8116, https://doi.org/10.1016/j.ijresmar.2006.10.005. https://www.sciencedirect.com/science/article/abs/pii/S016781160600084X</p>
<p>Artikkel uurib ettevõtete lojaalsusprogrammide mõju kliendilojaalsusele, arvestades valikunihet (selection bias). Lojaalsusprogrammi valivad need kliendid, kes juba nagunii kasutavad teenuseid enam. Seega ülehindaksime lojaalsusprogrammide mõju klientide lojaalsusele.</p>
<p>Meetod hõlmab kahesammulist vähimruutude meetodit (2SLS) koos instrumentmuutujatega, et hinnata lojaalsusprogrammi liikmesuse mõju kulutuste osakaalule (share-of-wallet, SOW).</p>
<section id="andmed" class="level3">
<h3 class="anchored" data-anchor-id="andmed">Andmed</h3>
<ol type="1">
<li><code>household_id</code>: Unikaalne ID igale majapidamisele.</li>
<li><code>loyalty_program_member</code>: Binaarne muutuja, mis näitab liikmesust (1, kui on liige; 0, kui ei ole).</li>
<li><code>share_of_wallet</code>: Majapidamise kulutuste osakaal poes.</li>
<li><code>economic_benefit</code>: Lojaalsusprogrammide tajutud majanduslik kasu (instrumentmuutuja). - üleüldine</li>
<li><code>non_economic_benefit</code>: Tajutud mittemajanduslik kasu (instrumentmuutuja). - üleüldine</li>
<li><code>privacy_concern</code>: Privaatsusega seotud mured lojaalsusprogrammide osas (instrumentmuutuja). - üleüldine</li>
<li><code>discount_rate</code>: Lojaalsusprogrammi allahindluse määr.</li>
<li><code>saving_rate</code>: Lojaalsusprogrammi säästumäär.</li>
<li><code>hh_income</code>: leibkonna sissetulek</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AER) <span class="co"># 2SLS mudeli jaoks</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer) <span class="co"># tulemuste esitamiseks</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich) <span class="co">#robustsed standardvead</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest) <span class="co">#testid</span></span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<!-- *Varjatud lojaalsuskalduvus*: loyalty_tendency on varjatud tegur, mis suurendab nii tõenäosust liituda lojaalsusprogrammiga kui ka share_of_wallet väärtust. See varjatud kalduvus võib tähistada loomupäraseid eelistusi lojaalsuse suhtes või tugevamat kiindumust jaemüüja vastu, mida ei kajasta otseselt vaadeldavad instrumendid. -->
<!-- loyalty_program_member simuleerimine loyalty_tendency abil: Kaasates loyalty_tendency logistilisse funktsiooni loyalty_program_member jaoks, simuleerime valikukallutatust. Majapidamised, kellel on kõrgemad loyalty_tendency väärtused, on tõenäolisemalt liikmed, ja see korreleerub ka suuremate kulutustega, luues seeläbi endogeensuse. -->
<!-- share_of_wallet simuleerimine loyalty_tendency abil: Kaasates loyalty_tendency share_of_wallet mudelisse, tagame, et share_of_wallet on mõjutatud sellest varjatud tegurist. See tähendab, et iga OLS hinnang loyalty_program_member mõju kohta share_of_wallet-ile on tõenäoliselt kallutatud, kuna see hõlmab osaliselt ka loyalty_tendency mõju. -->
<!-- Tekkiv valikunihe -->
<!-- Kui hindame loyalty_program_member mõju share_of_wallet-ile tavalise OLS-i abil, saame kallutatud hinnangu. Selle põhjuseks on asjaolu, et OLS omistab ekslikult osa loyalty_tendency (varjatud lojaalsuseelistuse) mõjust lojaalsusprogrammile endale. Kahesammuline väikseimate ruutude meetod (2SLS) koos kehtivate instrumentidega (nt economic_benefit, non_economic_benefit, privacy_concern) aitaks seda kallutatust vähendada, eraldades loyalty_program_member eksogeense varieeruvuse. -->
</section>
</section>
<section id="avame-andmed" class="level2" data-number="8.12">
<h2 data-number="8.12" class="anchored" data-anchor-id="avame-andmed"><span class="header-section-number">8.12</span> Avame andmed</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load(file = "kliendiprogramm.RData")</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"http://kodu.ut.ee/~avork/files/oppetoo/pohjustagajarg/kliendiprogramm.RData"</span>))</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Uurige andmed.</p>
<ol type="1">
<li>Kui palju kliente on lojaalsusprogrammis?</li>
<li>Kui suur on keskmine uuritavate toodete osakaal kogu kulutustes?</li>
<li>Kas see on suurem lojaalsusprogrammis osalejatel?</li>
<li>Uurige seoseid muutujate vahel korrelatsioonikordaja abil</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>loyalty_program_member)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
415 585 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2. </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>share_of_wallet)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1815  0.3732  0.4420  0.4268  0.4868  0.5753 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(data<span class="sc">$</span>share_of_wallet)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-ivmeetod_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3. </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(loyalty_program_member) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_sow =</span> <span class="fu">mean</span>(share_of_wallet))</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  loyalty_program_member mean_sow
                   &lt;int&gt;    &lt;dbl&gt;
1                      0    0.374
2                      1    0.464</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#4. </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>pairwise_correlations <span class="ot">&lt;-</span> <span class="fu">cor</span>(data, <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(pairwise_correlations, <span class="dv">3</span>)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       household_id hh_income economic_benefit
household_id                  1.000    -0.009            0.020
hh_income                    -0.009     1.000           -0.017
economic_benefit              0.020    -0.017            1.000
non_economic_benefit         -0.041    -0.045            0.061
privacy_concern              -0.003    -0.026           -0.021
discount_rate                -0.011    -0.013            0.035
saving_rate                   0.001    -0.055           -0.022
loyalty_program_member       -0.009    -0.035            0.134
share_of_wallet              -0.041     0.154           -0.002
                       non_economic_benefit privacy_concern discount_rate
household_id                         -0.041          -0.003        -0.011
hh_income                            -0.045          -0.026        -0.013
economic_benefit                      0.061          -0.021         0.035
non_economic_benefit                  1.000           0.033         0.016
privacy_concern                       0.033           1.000         0.058
discount_rate                         0.016           0.058         1.000
saving_rate                           0.034          -0.003         0.004
loyalty_program_member                0.205          -0.212         0.036
share_of_wallet                       0.054          -0.069         0.043
                       saving_rate loyalty_program_member share_of_wallet
household_id                 0.001                 -0.009          -0.041
hh_income                   -0.055                 -0.035           0.154
economic_benefit            -0.022                  0.134          -0.002
non_economic_benefit         0.034                  0.205           0.054
privacy_concern             -0.003                 -0.212          -0.069
discount_rate                0.004                  0.036           0.043
saving_rate                  1.000                 -0.006          -0.026
loyalty_program_member      -0.006                  1.000           0.558
share_of_wallet             -0.026                  0.558           1.000</code></pre>
</div>
</div>
<section id="ols" class="level3">
<h3 class="anchored" data-anchor-id="ols">OLS</h3>
<p>Hindame seose, kuidas SOW sõltub programmi kuulumisest, leibkonna sissetulekust ja kas programm annab allahindust või kogub raha.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Eirame valikunihet </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>olsmudel <span class="ot">&lt;-</span> <span class="fu">lm</span>(share_of_wallet <span class="sc">~</span> loyalty_program_member <span class="sc">+</span> hh_income <span class="sc">+</span> discount_rate <span class="sc">+</span> saving_rate, <span class="at">data =</span> data)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(olsmudel)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = share_of_wallet ~ loyalty_program_member + hh_income + 
    discount_rate + saving_rate, data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.224060 -0.037635  0.008201  0.043990  0.169021 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             0.323877   0.020517  15.786  &lt; 2e-16 ***
loyalty_program_member  0.090630   0.004146  21.858  &lt; 2e-16 ***
hh_income               0.024008   0.003558   6.747 2.55e-11 ***
discount_rate           0.098130   0.102266   0.960    0.338    
saving_rate            -0.051602   0.104142  -0.495    0.620    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06452 on 995 degrees of freedom
Multiple R-squared:  0.342, Adjusted R-squared:  0.3394 
F-statistic: 129.3 on 4 and 995 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#robustsed standardvead</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(olsmudel, <span class="at">vcov. =</span> sandwich)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

                         Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept)             0.3238767  0.0212438 15.2457 &lt; 2.2e-16 ***
loyalty_program_member  0.0906297  0.0043046 21.0543 &lt; 2.2e-16 ***
hh_income               0.0240079  0.0035947  6.6788 4.002e-11 ***
discount_rate           0.0981303  0.1042048  0.9417    0.3466    
saving_rate            -0.0516023  0.1091160 -0.4729    0.6364    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Meil ei ole heteroskedastiivsust</span></span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="kahesammulise-vähimruutude-meetodi-2sls-hinnang" class="level2" data-number="8.13">
<h2 data-number="8.13" class="anchored" data-anchor-id="kahesammulise-vähimruutude-meetodi-2sls-hinnang"><span class="header-section-number">8.13</span> Kahesammulise vähimruutude meetodi (2SLS) hinnang</h2>
<section id="esimene-samm-lojaalsusprogrammi-liikmesuse-prognoosimine" class="level3">
<h3 class="anchored" data-anchor-id="esimene-samm-lojaalsusprogrammi-liikmesuse-prognoosimine">Esimene samm: Lojaalsusprogrammi liikmesuse prognoosimine</h3>
<p>Esimeses etapis prognoosime loyalty_program_member instrumentaalmuutujate (economic_benefit, non_economic_benefit ja privacy_concern) ja teiste seotud muutujate (discount_rate ja saving_rate) abil.</p>
<p>Esimene samm: lojaalsusprogrammi liikmesuse prognoosimine</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>stage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(loyalty_program_member <span class="sc">~</span> economic_benefit <span class="sc">+</span> non_economic_benefit <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>             privacy_concern <span class="sc">+</span> discount_rate <span class="sc">+</span> saving_rate, <span class="at">data =</span> data)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stage1)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = loyalty_program_member ~ economic_benefit + non_economic_benefit + 
    privacy_concern + discount_rate + saving_rate, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.0748 -0.4791  0.2107  0.4044  0.8670 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           0.40758    0.13749   2.964 0.003106 ** 
economic_benefit      0.11333    0.02963   3.825 0.000139 ***
non_economic_benefit  0.20501    0.03013   6.803 1.76e-11 ***
privacy_concern      -0.21476    0.02959  -7.257 7.98e-13 ***
discount_rate         1.02089    0.74229   1.375 0.169341    
saving_rate          -0.27984    0.75413  -0.371 0.710663    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4675 on 994 degrees of freedom
Multiple R-squared:  0.1051,    Adjusted R-squared:  0.1006 
F-statistic: 23.35 on 5 and 994 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Mis mõjutab lojaalsusprogrammi astumist?</p>
<p>Lojaalsusprogrammi liikmesuse prognoositud väärtused</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>predicted_loyalty <span class="ot">&lt;-</span> <span class="fu">predict</span>(stage1)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Teine samm: Prognoositud lojaalsuse kasutamine kulutuste osakaalu mudelis Teises etapis kasutame esimeses etapis saadud prognoositud väärtusi mudelis share_of_wallet jaoks.</p>
<p>Teine samm: 2SLS hinnang, kasutades lojaalsusprogrammi liikmesuse prognoositud väärtusi</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>stage2iv <span class="ot">&lt;-</span> <span class="fu">lm</span>(share_of_wallet <span class="sc">~</span> predicted_loyalty <span class="sc">+</span> hh_income <span class="sc">+</span>  discount_rate <span class="sc">+</span> saving_rate, <span class="at">data =</span> data)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="teise-etapi-kokkuvõte" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Teise etapi kokkuvõte</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stage2iv)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = share_of_wallet ~ predicted_loyalty + hh_income + 
    discount_rate + saving_rate, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.24421 -0.04897  0.01600  0.05955  0.16871 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        0.355071   0.026039  13.636  &lt; 2e-16 ***
predicted_loyalty  0.041819   0.015585   2.683  0.00741 ** 
hh_income          0.021439   0.004311   4.973 7.77e-07 ***
discount_rate      0.140515   0.124660   1.127  0.25994    
saving_rate       -0.063186   0.126267  -0.500  0.61689    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.07821 on 995 degrees of freedom
Multiple R-squared:  0.0331,    Adjusted R-squared:  0.02921 
F-statistic: 8.515 on 4 and 995 DF,  p-value: 9.326e-07</code></pre>
</div>
</div>
<p>Võrdleme</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(olsmudel, stage2iv, stage1, <span class="at">type =</span> <span class="st">"text"</span>, <span class="at">no.space =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==============================================================================================
                                                 Dependent variable:                          
                       -----------------------------------------------------------------------
                                       share_of_wallet                 loyalty_program_member 
                                 (1)                     (2)                     (3)          
----------------------------------------------------------------------------------------------
loyalty_program_member         0.091***                                                       
                               (0.004)                                                        
predicted_loyalty                                      0.042***                               
                                                       (0.016)                                
hh_income                      0.024***                0.021***                               
                               (0.004)                 (0.004)                                
economic_benefit                                                              0.113***        
                                                                               (0.030)        
non_economic_benefit                                                          0.205***        
                                                                               (0.030)        
privacy_concern                                                               -0.215***       
                                                                               (0.030)        
discount_rate                   0.098                   0.141                   1.021         
                               (0.102)                 (0.125)                 (0.742)        
saving_rate                     -0.052                  -0.063                 -0.280         
                               (0.104)                 (0.126)                 (0.754)        
Constant                       0.324***                0.355***               0.408***        
                               (0.021)                 (0.026)                 (0.137)        
----------------------------------------------------------------------------------------------
Observations                    1,000                   1,000                   1,000         
R2                              0.342                   0.033                   0.105         
Adjusted R2                     0.339                   0.029                   0.101         
Residual Std. Error        0.065 (df = 995)        0.078 (df = 995)       0.468 (df = 994)    
F Statistic            129.313*** (df = 4; 995) 8.515*** (df = 4; 995) 23.349*** (df = 5; 994)
==============================================================================================
Note:                                                              *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p>Kontrollfunktsiooniga (control function)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Käsitsi</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>vhat <span class="ot">&lt;-</span> <span class="fu">residuals</span>(stage1)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>stage2ivcf <span class="ot">&lt;-</span> <span class="fu">lm</span>(share_of_wallet <span class="sc">~</span> loyalty_program_member <span class="sc">+</span> hh_income <span class="sc">+</span>  discount_rate <span class="sc">+</span> saving_rate <span class="sc">+</span> vhat, <span class="at">data =</span> data)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stage2ivcf)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = share_of_wallet ~ loyalty_program_member + hh_income + 
    discount_rate + saving_rate + vhat, data = data)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.228574 -0.037329  0.007011  0.043737  0.166588 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             0.349325   0.021319  16.386  &lt; 2e-16 ***
loyalty_program_member  0.041965   0.012759   3.289  0.00104 ** 
hh_income               0.023937   0.003531   6.779 2.08e-11 ***
discount_rate           0.141278   0.102055   1.384  0.16657    
saving_rate            -0.059166   0.103371  -0.572  0.56720    
vhat                    0.054305   0.013476   4.030 6.01e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06403 on 994 degrees of freedom
Multiple R-squared:  0.3526,    Adjusted R-squared:  0.3494 
F-statistic: 108.3 on 5 and 994 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(olsmudel, stage2iv, stage2ivcf, stage1, <span class="at">type =</span> <span class="st">"text"</span>, <span class="at">no.space =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=======================================================================================================================
                                                             Dependent variable:                                       
                       ------------------------------------------------------------------------------------------------
                                                   share_of_wallet                               loyalty_program_member 
                                 (1)                     (2)                     (3)                      (4)          
-----------------------------------------------------------------------------------------------------------------------
loyalty_program_member         0.091***                                        0.042***                                
                               (0.004)                                         (0.013)                                 
predicted_loyalty                                      0.042***                                                        
                                                       (0.016)                                                         
hh_income                      0.024***                0.021***                0.024***                                
                               (0.004)                 (0.004)                 (0.004)                                 
economic_benefit                                                                                       0.113***        
                                                                                                        (0.030)        
non_economic_benefit                                                                                   0.205***        
                                                                                                        (0.030)        
privacy_concern                                                                                        -0.215***       
                                                                                                        (0.030)        
discount_rate                   0.098                   0.141                   0.141                    1.021         
                               (0.102)                 (0.125)                 (0.102)                  (0.742)        
saving_rate                     -0.052                  -0.063                  -0.059                  -0.280         
                               (0.104)                 (0.126)                 (0.103)                  (0.754)        
vhat                                                                           0.054***                                
                                                                               (0.013)                                 
Constant                       0.324***                0.355***                0.349***                0.408***        
                               (0.021)                 (0.026)                 (0.021)                  (0.137)        
-----------------------------------------------------------------------------------------------------------------------
Observations                    1,000                   1,000                   1,000                    1,000         
R2                              0.342                   0.033                   0.353                    0.105         
Adjusted R2                     0.339                   0.029                   0.349                    0.101         
Residual Std. Error        0.065 (df = 995)        0.078 (df = 995)        0.064 (df = 994)        0.468 (df = 994)    
F Statistic            129.313*** (df = 4; 995) 8.515*** (df = 4; 995) 108.282*** (df = 5; 994) 23.349*** (df = 5; 994)
=======================================================================================================================
Note:                                                                                       *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p>Kontrollige, et tulemus on sama</p>
<p>Alternatiiv: 2SLS-i kasutamine ivreg funktsiooniga 2SLS-i saab teostada ka ivreg funktsiooni abil paketist AER, mis viib läbi mõlemad sammud korraga.</p>
<p>Kahesammuline väikseimate ruutude meetod (2SLS) ivreg funktsiooniga</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>iv_model <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(share_of_wallet <span class="sc">~</span> loyalty_program_member <span class="sc">+</span> hh_income <span class="sc">+</span> discount_rate <span class="sc">+</span> saving_rate <span class="sc">|</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                    economic_benefit <span class="sc">+</span> non_economic_benefit <span class="sc">+</span> privacy_concern <span class="sc">+</span> hh_income <span class="sc">+</span> discount_rate <span class="sc">+</span> saving_rate, <span class="at">data =</span> data)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2SLS mudeli kokkuvõte</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iv_model)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ivreg(formula = share_of_wallet ~ loyalty_program_member + hh_income + 
    discount_rate + saving_rate | economic_benefit + non_economic_benefit + 
    privacy_concern + hh_income + discount_rate + saving_rate, 
    data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.21244 -0.04444  0.01049  0.05093  0.14322 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             0.352557   0.023195  15.200  &lt; 2e-16 ***
loyalty_program_member  0.041907   0.013740   3.050  0.00235 ** 
hh_income               0.022527   0.003818   5.901 4.96e-09 ***
discount_rate           0.140825   0.109726   1.283  0.19964    
saving_rate            -0.061432   0.111165  -0.553  0.58065    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06885 on 995 degrees of freedom
Multiple R-Squared: 0.2507, Adjusted R-squared: 0.2477 
Wald test: 10.99 on 4 and 995 DF,  p-value: 1.003e-08 </code></pre>
</div>
</div>
<p>Võrdlus</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(olsmudel, iv_model, stage2iv, stage2ivcf, stage1, <span class="at">type =</span> <span class="st">"text"</span>, <span class="at">no.space =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
========================================================================================================================================
                                                                      Dependent variable:                                               
                       -----------------------------------------------------------------------------------------------------------------
                                                            share_of_wallet                                      loyalty_program_member
                                 OLS              instrumental                         OLS                                 OLS          
                                                    variable                                                                            
                                 (1)                  (2)                 (3)                     (4)                      (5)          
----------------------------------------------------------------------------------------------------------------------------------------
loyalty_program_member         0.091***             0.042***                                    0.042***                                
                               (0.004)              (0.014)                                     (0.013)                                 
predicted_loyalty                                                       0.042***                                                        
                                                                        (0.016)                                                         
hh_income                      0.024***             0.023***            0.021***                0.024***                                
                               (0.004)              (0.004)             (0.004)                 (0.004)                                 
economic_benefit                                                                                                        0.113***        
                                                                                                                         (0.030)        
non_economic_benefit                                                                                                    0.205***        
                                                                                                                         (0.030)        
privacy_concern                                                                                                         -0.215***       
                                                                                                                         (0.030)        
discount_rate                   0.098                0.141               0.141                   0.141                    1.021         
                               (0.102)              (0.110)             (0.125)                 (0.102)                  (0.742)        
saving_rate                     -0.052               -0.061              -0.063                  -0.059                  -0.280         
                               (0.104)              (0.111)             (0.126)                 (0.103)                  (0.754)        
vhat                                                                                            0.054***                                
                                                                                                (0.013)                                 
Constant                       0.324***             0.353***            0.355***                0.349***                0.408***        
                               (0.021)              (0.023)             (0.026)                 (0.021)                  (0.137)        
----------------------------------------------------------------------------------------------------------------------------------------
Observations                    1,000                1,000               1,000                   1,000                    1,000         
R2                              0.342                0.251               0.033                   0.353                    0.105         
Adjusted R2                     0.339                0.248               0.029                   0.349                    0.101         
Residual Std. Error        0.065 (df = 995)     0.069 (df = 995)    0.078 (df = 995)        0.064 (df = 994)        0.468 (df = 994)    
F Statistic            129.313*** (df = 4; 995)                  8.515*** (df = 4; 995) 108.282*** (df = 5; 994) 23.349*** (df = 5; 994)
========================================================================================================================================
Note:                                                                                                        *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
</div>
<p>Selgitus</p>
<p>ivreg funktsioon: See funktsioon hindab 2SLS mudelit. Esimene osa (share_of_wallet ~ loyalty_program_member + hh_income + discount_rate + saving_rate) määrab tulemuse ja endogeense muutuja, samas kui teine osa (|economic_benefit + non_economic_benefit + privacy_concern + hh_income + discount_rate + saving_rate) määrab instrumendid ja eksogeensed muutujad.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iv_model, <span class="at">diagnostics =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ivreg(formula = share_of_wallet ~ loyalty_program_member + hh_income + 
    discount_rate + saving_rate | economic_benefit + non_economic_benefit + 
    privacy_concern + hh_income + discount_rate + saving_rate, 
    data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.21244 -0.04444  0.01049  0.05093  0.14322 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             0.352557   0.023195  15.200  &lt; 2e-16 ***
loyalty_program_member  0.041907   0.013740   3.050  0.00235 ** 
hh_income               0.022527   0.003818   5.901 4.96e-09 ***
discount_rate           0.140825   0.109726   1.283  0.19964    
saving_rate            -0.061432   0.111165  -0.553  0.58065    

Diagnostic tests:
                 df1 df2 statistic  p-value    
Weak instruments   3 993    38.299  &lt; 2e-16 ***
Wu-Hausman         1 994    16.222 6.06e-05 ***
Sargan             2  NA     2.108    0.349    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06885 on 995 degrees of freedom
Multiple R-Squared: 0.2507, Adjusted R-squared: 0.2477 
Wald test: 10.99 on 4 and 995 DF,  p-value: 1.003e-08 </code></pre>
</div>
</div>
<p>summary(iv_model): Kuvab 2SLS hinnangu tulemused, näidates lojaalsusprogrammi liikmesuse mõju kulutuste osakaalule, arvestades endogeensuse probleemiga.</p>
<section id="testid" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="testid"><span class="header-section-number">9.1</span> Testid</h2>
<p>Wu-Hausmani test</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Kas meil on instrumenti vaja?</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#T-test</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stage2ivcf)<span class="sc">$</span>coefficients[<span class="st">"vhat"</span>,]</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Estimate   Std. Error      t value     Pr(&gt;|t|) 
5.430503e-02 1.347645e-02 4.029623e+00 6.012936e-05 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#F-test</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(olsmudel, stage2ivcf)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: share_of_wallet ~ loyalty_program_member + hh_income + discount_rate + 
    saving_rate
Model 2: share_of_wallet ~ loyalty_program_member + hh_income + discount_rate + 
    saving_rate + vhat
  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1    995 4.1421                                  
2    994 4.0755  1  0.066577 16.238 6.013e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Waldi test</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">waldtest</span>(olsmudel, stage2ivcf, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wald test

Model 1: share_of_wallet ~ loyalty_program_member + hh_income + discount_rate + 
    saving_rate
Model 2: share_of_wallet ~ loyalty_program_member + hh_income + discount_rate + 
    saving_rate + vhat
  Res.Df Df  Chisq Pr(&gt;Chisq)    
1    995                         
2    994  1 16.238  5.587e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#See test on esitatud ivreg tulemustest</span></span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iv_model, <span class="at">diagnostics =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ivreg(formula = share_of_wallet ~ loyalty_program_member + hh_income + 
    discount_rate + saving_rate | economic_benefit + non_economic_benefit + 
    privacy_concern + hh_income + discount_rate + saving_rate, 
    data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.21244 -0.04444  0.01049  0.05093  0.14322 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             0.352557   0.023195  15.200  &lt; 2e-16 ***
loyalty_program_member  0.041907   0.013740   3.050  0.00235 ** 
hh_income               0.022527   0.003818   5.901 4.96e-09 ***
discount_rate           0.140825   0.109726   1.283  0.19964    
saving_rate            -0.061432   0.111165  -0.553  0.58065    

Diagnostic tests:
                 df1 df2 statistic  p-value    
Weak instruments   3 993    38.299  &lt; 2e-16 ***
Wu-Hausman         1 994    16.222 6.06e-05 ***
Sargan             2  NA     2.108    0.349    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06885 on 995 degrees of freedom
Multiple R-Squared: 0.2507, Adjusted R-squared: 0.2477 
Wald test: 10.99 on 4 and 995 DF,  p-value: 1.003e-08 </code></pre>
</div>
</div>
</section>
<section id="kas-instrumendid-on-tugevad" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="kas-instrumendid-on-tugevad"><span class="header-section-number">9.2</span> Kas instrumendid on tugevad?</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stage1)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = loyalty_program_member ~ economic_benefit + non_economic_benefit + 
    privacy_concern + discount_rate + saving_rate, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.0748 -0.4791  0.2107  0.4044  0.8670 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           0.40758    0.13749   2.964 0.003106 ** 
economic_benefit      0.11333    0.02963   3.825 0.000139 ***
non_economic_benefit  0.20501    0.03013   6.803 1.76e-11 ***
privacy_concern      -0.21476    0.02959  -7.257 7.98e-13 ***
discount_rate         1.02089    0.74229   1.375 0.169341    
saving_rate          -0.27984    0.75413  -0.371 0.710663    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4675 on 994 degrees of freedom
Multiple R-squared:  0.1051,    Adjusted R-squared:  0.1006 
F-statistic: 23.35 on 5 and 994 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#F-test - võrdleme meie mudelit ja ilma instrumentideta mudelit</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>stage1abi <span class="ot">&lt;-</span> <span class="fu">lm</span>(loyalty_program_member <span class="sc">~</span> discount_rate <span class="sc">+</span> saving_rate, <span class="at">data =</span> data)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(stage1abi, stage1)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: loyalty_program_member ~ discount_rate + saving_rate
Model 2: loyalty_program_member ~ economic_benefit + non_economic_benefit + 
    privacy_concern + discount_rate + saving_rate
  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1    997 242.45                                  
2    994 217.26  3    25.195 38.423 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#F-test on oluline ja suurem ka kui 10</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Sama oli siin</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iv_model, <span class="at">diagnostics =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Kopeeri lõikelauale" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
ivreg(formula = share_of_wallet ~ loyalty_program_member + hh_income + 
    discount_rate + saving_rate | economic_benefit + non_economic_benefit + 
    privacy_concern + hh_income + discount_rate + saving_rate, 
    data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.21244 -0.04444  0.01049  0.05093  0.14322 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             0.352557   0.023195  15.200  &lt; 2e-16 ***
loyalty_program_member  0.041907   0.013740   3.050  0.00235 ** 
hh_income               0.022527   0.003818   5.901 4.96e-09 ***
discount_rate           0.140825   0.109726   1.283  0.19964    
saving_rate            -0.061432   0.111165  -0.553  0.58065    

Diagnostic tests:
                 df1 df2 statistic  p-value    
Weak instruments   3 993    38.299  &lt; 2e-16 ***
Wu-Hausman         1 994    16.222 6.06e-05 ***
Sargan             2  NA     2.108    0.349    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06885 on 995 degrees of freedom
Multiple R-Squared: 0.2507, Adjusted R-squared: 0.2477 
Wald test: 10.99 on 4 and 995 DF,  p-value: 1.003e-08 </code></pre>
</div>
</div>
</section>
<section id="kas-instrumendid-on-sobivad" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="kas-instrumendid-on-sobivad"><span class="header-section-number">9.3</span> Kas instrumendid on sobivad?</h2>
<p>Sargani test on võimalik, siis kui instrumente rohkem kui vaja. Meil on 3, vaja on 1.</p>
<p>H0 - instrumendid ei korreleeru vealiikmega H1 - vähemalt üks instrument korreleerub vealiikmega</p>
<p>Me ei saa ümber lükata H0. Seega selle koha pealt formaalselt korras</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Kopeeritud!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Kopeeritud!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-sobitamine.html" class="pagination-link" aria-label="Sobitamine">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Sobitamine</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-synthcontr.html" class="pagination-link" aria-label="Sünteetilise võrdlusobjekti meetod">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Sünteetilise võrdlusobjekti meetod</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>